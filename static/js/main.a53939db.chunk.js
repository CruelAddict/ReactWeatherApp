(this.webpackJsonpuntitled1=this.webpackJsonpuntitled1||[]).push([[0],{20:function(e,t,a){e.exports=a(31)},30:function(e,t,a){},31:function(e,t,a){"use strict";a.r(t);var n=a(8),r=a(0),i=a.n(r),o=a(12),c=a.n(o),s=a(2),l=a(3),u=a(5),m=a(4),d=a(6),h=a(1),p=a(7),f={CREATE_FAVORITE:"CREATE_FAVORITE",DELETE_FAVORITE:"DELETE_FAVORITE",SET_GEOLOCATION:"SET_GEOLOCATION",SET_FAVORITES_WEATHER:"SET_FAVORITE_WEATHER",SET_MAIN_WEATHER:"SET_MAIN_WEATHER"},v=function(e){return{type:f.CREATE_FAVORITE,payload:e}},b=function(e){return{type:f.DELETE_FAVORITE,payload:e}},E=function(e){return function(t){return t({type:f.SET_GEOLOCATION,payload:e}),Promise.resolve()}},O=function(e,t){return function(a){e.getWeather().then((function(e){a({type:f.SET_FAVORITES_WEATHER,payload:{id:t,weatherObj:e}})}),(function(e){a({type:f.SET_FAVORITES_WEATHER,payload:{id:t,weatherObj:{isLoading:!1,isFailed:!0,errorMessage:e}}})}))}},g=function(e){return function(t){e.getWeather().then((function(e){console.log("dispatching main weather"),!1!==e&&t({type:f.SET_MAIN_WEATHER,payload:{weatherObj:e}})}),(function(e){t({type:f.SET_MAIN_WEATHER,payload:{weatherObj:{isLoading:!1,isFailed:!0,errorMessage:e}}})}))}},y=f,j=function(e){return i.a.createElement("div",{className:"favorites-header-container"},i.a.createElement("div",{className:"favorites-title-container"},i.a.createElement("h2",null,"\u0418\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435")),i.a.createElement("form",{className:"new-favorite-form",onSubmit:e.handleSubmit},i.a.createElement("input",{placeholder:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0433\u043e\u0440\u043e\u0434",className:"add-favorite-input",value:e.state.favoritesInput,onChange:e.handleChange}),i.a.createElement("button",{className:"favorites-action-button"},"+")))},w="bf3565940c52aaa3383c1dbc23799bb1",N=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).weatherByNameUrl=function(){return"http://api.openweathermap.org/data/2.5/weather?q=".concat(e.props.city,"&appid=").concat(e.state.api_key)},e.weatherByCoordinatesUrl=function(){return"http://api.openweathermap.org/data/2.5/weather?lat=".concat(ee.getState().geo.coordinates.latitude,"&lon=").concat(ee.getState().geo.coordinates.longitude,"&appid=").concat(e.state.api_key)},e.state={isLoading:!0,api_key:w},e.getWeather=e.getWeather.bind(Object(h.a)(e)),e.weatherByNameUrl=e.weatherByNameUrl.bind(Object(h.a)(e)),e.weatherByCoordinatesUrl=e.weatherByCoordinatesUrl.bind(Object(h.a)(e)),e.execWeatherRequest=e.execWeatherRequest.bind(Object(h.a)(e)),e.parseWeatherData=e.parseWeatherData.bind(Object(h.a)(e)),e.getIcon=e.getIcon.bind(Object(h.a)(e)),e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.setState({isLoading:!0,isFailed:!1})}},{key:"execWeatherRequest",value:function(e){var t=this;return new Promise((function(a,n){console.log("executing request");var r=new XMLHttpRequest;r.open("GET",e),r.send(),r.onreadystatechange=function(e){if(4===r.readyState)if(r.responseText)if(200===r.status){var i=JSON.parse(r.responseText);t.parseWeatherData(i).then((function(e){return a(e)}),(function(e){return n(e)}))}else 404===r.status?n("\u0413\u043e\u0440\u043e\u0434 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"):n("\u041e\u0442\u043a\u0430\u0437 \u0441\u0435\u0440\u0432\u0435\u0440\u0430");else n("\u0421\u0435\u0440\u0432\u0435\u0440 \u043d\u0435 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442")}}))}},{key:"parseWeatherData",value:function(e){var t=this;return new Promise((function(a,n){console.log("parsing data");var r=e.main.temp-273.15,i=e.wind.speed,o=e.main.humidity,c=e.main.pressure,s={longitude:e.coord.lon,latitude:e.coord.lat},l=e.name,u=e.weather[0].description,m=e.weather[0].icon;t.getIcon(m).then((function(e){return e.blob()})).then((function(e){var t=(window.URL||window.webkitURL).createObjectURL(e);console.log("weather data parsed"),a({city:l,coordinates:s,isLoading:!1,isFailed:!1,weather_data:{temperature:r,wind:i,humidity:o,pressure:c,cloudiness:u,icon:t}})}),(function(){n("\u0421\u0435\u0440\u0432\u0435\u0440 \u043d\u0435 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442")}))}))}},{key:"getIcon",value:function(e){return fetch("http://openweathermap.org/img/wn/".concat(e,"@2x.png"),{method:"GET"})}},{key:"getWeather",value:function(){var e=this;return new Promise((function(t,a){var n=e.weatherByCoordinatesUrl();e.execWeatherRequest(n).then((function(e){return t(e)}),(function(e){return a(e)}))}))}},{key:"raiseError",value:function(e){console.log(e)}}]),t}(r.Component),T=function(e){return i.a.createElement("div",{className:"weather-value-list"},i.a.createElement("div",{className:"weather-value-row"},i.a.createElement("span",{className:"weather-value-key"},"\u0412\u0435\u0442\u0435\u0440"),i.a.createElement("span",{className:"weather-value-value"},e.state.weather_data.wind," m/s")),i.a.createElement("div",{className:"weather-value-row"},i.a.createElement("span",{className:"weather-value-key"},"\u041e\u0431\u043b\u0430\u0447\u043d\u043e\u0441\u0442\u044c"),i.a.createElement("span",{className:"weather-value-value"},e.state.weather_data.cloudiness.split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.substring(1)})).join(" "))),i.a.createElement("div",{className:"weather-value-row"},i.a.createElement("span",{className:"weather-value-key"},"\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435"),i.a.createElement("span",{className:"weather-value-value"},e.state.weather_data.pressure," hpa")),i.a.createElement("div",{className:"weather-value-row"},i.a.createElement("span",{className:"weather-value-key"},"\u0412\u043b\u0430\u0436\u043d\u043e\u0441\u0442\u044c"),i.a.createElement("span",{className:"weather-value-value"},e.state.weather_data.humidity," %")),i.a.createElement("div",{className:"weather-value-row"},i.a.createElement("span",{className:"weather-value-key"},"\u041a\u043e\u043e\u0440\u0434\u0438\u043d\u0430\u0442\u044b"),i.a.createElement("span",{className:"weather-value-value"},"[",e.state.coordinates.longitude.toFixed(2),", ",e.state.coordinates.latitude.toFixed(2),"]")))},S=function(e){var t="\u0413\u043e\u0440\u043e\u0434 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"===e.state.errorMessage;return e.state.isLoading?i.a.createElement("div",{className:"side-weather-panel-container"},i.a.createElement("div",{className:"side-weather-panel-main-data"},i.a.createElement("div",{className:"side-city-name-container"},i.a.createElement("h2",null,e.state.city)),i.a.createElement("div",{className:"side-temperature-container"}),i.a.createElement("div",{className:"side-icon-cell"},i.a.createElement("div",null)),i.a.createElement("div",{className:"delete-favorite-button-container"},i.a.createElement("button",{onClick:e.handleFavoriteRemoval,className:"delete-favorite favorites-action-button"},"\xd7"))),i.a.createElement("div",{className:"loading-side"},i.a.createElement("h4",{className:"loading-title-side"},"\u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435, \u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f"),i.a.createElement("div",{className:"spinner-container"},i.a.createElement("i",{className:"fa fa-refresh fa-spin fa-4x"})))):e.state.isFailed?i.a.createElement("div",{className:t?"side-weather-panel-container city-not-found":"side-weather-panel-container"},i.a.createElement("div",{className:"side-weather-panel-main-data"},i.a.createElement("div",{className:"side-city-name-container"},i.a.createElement("h2",null,e.state.city)),i.a.createElement("div",{className:"side-temperature-container"}),i.a.createElement("div",{className:"side-icon-cell"},i.a.createElement("div",null)),i.a.createElement("div",{className:"delete-favorite-button-container"},i.a.createElement("button",{onClick:e.handleFavoriteRemoval,className:"delete-favorite favorites-action-button"},"\xd7"))),t?i.a.createElement("div",{className:"loading-side"},i.a.createElement("h4",{className:"loading-title-side side-error-message"},e.state.errorMessage)):i.a.createElement("div",{className:"loading-side"},i.a.createElement("h4",{className:"loading-title-side side-error-message"},e.state.errorMessage),i.a.createElement("div",{className:"refresh-button-container"},i.a.createElement("button",{className:"refresh-button",onClick:e.setWeather},"\u041f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u043d\u043e\u0432\u0430")))):i.a.createElement("div",{className:"side-weather-panel-container"},i.a.createElement("div",{className:"side-weather-panel-main-data"},i.a.createElement("div",{className:"side-city-name-container"},i.a.createElement("h2",null,e.state.city)),i.a.createElement("div",{className:"side-temperature-container"},i.a.createElement("span",null,e.state.weather_data.temperature.toFixed(0),"\xb0\u0421")),i.a.createElement("div",{className:"side-icon-cell"},i.a.createElement("div",{className:"side-icon-container"},i.a.createElement("img",{src:e.state.weather_data.icon,alt:"weather icon"}))),i.a.createElement("div",{className:"delete-favorite-button-container"},i.a.createElement("button",{onClick:e.handleFavoriteRemoval,className:"delete-favorite favorites-action-button"},"\xd7"))),i.a.createElement("div",{className:"side-weather-items"},i.a.createElement(T,{state:e.state})))};function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var k=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).handleFavoriteRemoval=e.handleFavoriteRemoval.bind(Object(h.a)(e)),e.setWeather=e.setWeather.bind(Object(h.a)(e)),e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setWeather(),this.setState(this.props.favorites.items.filter((function(t){return t.id===e.props.favoriteId}))[0].weatherObj)}},{key:"componentDidUpdate",value:function(e){var t=this,a=e.favorites.items.filter((function(e){return e.id===t.props.favoriteId}))[0].weatherObj,n=this.props.favorites.items.filter((function(e){return e.id===t.props.favoriteId}))[0].weatherObj;a!==n&&this.setState(n)}},{key:"setWeather",value:function(){this.props.setFavoriteWeather(this,this.props.favoriteId)}},{key:"getWeather",value:function(){var e=this;return new Promise((function(t,a){var n=e.weatherByNameUrl();e.execWeatherRequest(n).then((function(e){return t(e)}),(function(e){return a(e)}))}))}},{key:"handleFavoriteRemoval",value:function(){this.props.deleteFavorite(this.props.favoriteId)}},{key:"render",value:function(){return i.a.createElement(S,{state:this.state,handleFavoriteRemoval:this.handleFavoriteRemoval,setWeather:this.setWeather})}}]),t}(N),P=Object(p.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(a,!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)}),(function(e){return{deleteFavorite:function(t){return e(b(t))},setFavoriteWeather:function(t,a){return e(O(t,a))}}}))(k),_=Object(p.b)((function(e){return{items:e.favorites.items}}))((function(e){return i.a.createElement("div",{className:"favorites-container"},e.items.map((function(e){return i.a.createElement(P,{city:e.name,key:e.id,favoriteId:e.id})})))})),I=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(_,null)}}]),t}(i.a.Component);function W(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var A=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).handleSubmit=e.handleSubmit.bind(Object(h.a)(e)),e.handleChange=e.handleChange.bind(Object(h.a)(e)),e.state={favoritesInput:""},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"handleSubmit",value:function(e){this.props.createFavorite(this.state.favoritesInput),e.preventDefault()}},{key:"handleChange",value:function(e){this.setState({favoritesInput:e.target.value})}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(j,{handleSubmit:this.handleSubmit,handleChange:this.handleChange,state:this.state}),i.a.createElement(I,null))}}]),t}(r.Component),F=Object(p.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?W(a,!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):W(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)}),(function(e){return{createFavorite:function(t){return e(v(t))}}}))(A),D=function(e){return e.state.isLoading?i.a.createElement("div",{className:"loading-main"},i.a.createElement("h4",{className:"loading-title-main"},"\u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435, \u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f"),i.a.createElement("div",{className:"spinner-container"},i.a.createElement("i",{className:"fa fa-refresh fa-spin fa-4x"}))):e.state.isFailed?i.a.createElement("div",{className:"loading-main"},i.a.createElement("h4",{className:"loading-title-main error-message-main"},e.state.errorMessage),i.a.createElement("span",{className:"error-help-main"},'\u0427\u0442\u043e\u0431\u044b \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0435\u0449\u0435 \u0440\u0430\u0437, \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043a\u043d\u043e\u043f\u043a\u0443 "\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u0435\u043e\u043b\u043e\u043a\u0430\u0446\u0438\u044e"')):i.a.createElement("div",{className:"main-weather-panel-container"},i.a.createElement("div",{className:"main-weather-panel-main-data"},i.a.createElement("div",{className:"main-city-name-container"},i.a.createElement("h2",null,e.state.city)),i.a.createElement("div",{className:"icon-cell"},i.a.createElement("div",{className:"icon-container"},i.a.createElement("img",{src:e.state.weather_data.icon,alt:"weather icon"}))),i.a.createElement("div",{className:"temperature-container"},i.a.createElement("span",null,e.state.weather_data.temperature.toFixed(0),"\xb0\u0421"))),i.a.createElement(T,{state:e.state}))},C=function(e){return i.a.createElement("div",{id:"app-header"},i.a.createElement("div",{className:"header-text-container"},i.a.createElement("h1",{className:"header-text"},"\u041f\u043e\u0433\u043e\u0434\u0430 \u0437\u0434\u0435\u0441\u044c")),i.a.createElement("div",{className:"button-container"},i.a.createElement("button",{onClick:e.refreshGeo,className:"geo-refresh-button"},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u0435\u043e\u043b\u043e\u043a\u0430\u0446\u0438\u044e")))},L={latitude:51.507351,longitude:-.127758},G=function(e){return navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){ee.dispatch(E({permissionGranted:!0,coordinates:{latitude:t.coords.latitude,longitude:t.coords.longitude}})).then(e)}),(function(){ee.dispatch(E({permissionGranted:!1,coordinates:L})).then(e)})):console.log("Not supported"),Promise.resolve()},x=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).refreshGeo=e.refreshGeo.bind(Object(h.a)(e)),e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"refreshGeo",value:function(){G(this.props.mainLocationRefresh)}},{key:"render",value:function(){return i.a.createElement(C,{refreshGeo:this.refreshGeo})}}]),t}(r.Component),M=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).mainLocationRefresh=e.mainLocationRefresh.bind(Object(h.a)(e)),e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.setWeather(),this.setState(this.props.geo.weatherObj)}},{key:"componentDidUpdate",value:function(e){var t=e.geo.weatherObj,a=this.props.geo.weatherObj;console.log(a),t!==a&&this.setState(a)}},{key:"setWeather",value:function(){this.props.setMainWeather(this)}},{key:"mainLocationRefresh",value:function(){this.setState({isLoading:!0}),this.setWeather()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(x,{mainLocationRefresh:this.mainLocationRefresh}),i.a.createElement(D,{state:this.state}))}}]),t}(N),U=Object(p.b)((function(e){return{geo:e.geo}}),(function(e){return{setMainWeather:function(t){return e(g(t))}}}))(M),V=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this))).state={coordinates:e.coordinates},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){G()}},{key:"render",value:function(){return null===this.props.permissionGranted?null:i.a.createElement("div",{id:"app"},i.a.createElement(U,{coordinates:this.props.coordinates}),i.a.createElement(F,null))}}]),t}(i.a.Component),H=Object(p.b)((function(e){return{permissionGranted:e.geo.permissionGranted,coordinates:e.geo.coordinates}}))(V),B=a(10),q=a(18),J=a(19);function X(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function z(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?X(a,!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):X(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var K=Object(B.c)({favorites:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{items:[]},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y.CREATE_FAVORITE:return{items:[].concat(Object(J.a)(e.items),[{id:0===e.items.length?0:e.items[e.items.length-1].id+1,name:t.payload}])};case y.SET_FAVORITES_WEATHER:return{items:e.items.map((function(e,a,n){return e.id===t.payload.id?{id:e.id,name:e.name,weatherObj:t.payload.weatherObj}:e}))};case y.DELETE_FAVORITE:return{items:e.items.filter((function(e,a,n){return e.id!==t.payload}))};default:return e}},geo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{permissionGranted:null,coordinates:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y.SET_GEOLOCATION:return z({},e,{},t.payload);case y.SET_MAIN_WEATHER:return z({},e,{weatherObj:t.payload.weatherObj});default:return e}}});function Q(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var Y={favorites:{items:localStorage.getItem("favorites")?JSON.parse(localStorage.getItem("favorites")).map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Q(a,!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Q(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e,{isLoading:!0})})):[]},geo:{permissionGranted:null,coordinates:null}};a(30);function Z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var $=Object(B.d)(K,Y,Object(B.a)(q.a));$.subscribe((function(){localStorage.setItem("favorites",JSON.stringify($.getState().favorites.items.map((function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Z(a,!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Z(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e);return delete t.weatherObj,console.log(t),t}))))})),c.a.render(i.a.createElement(p.a,{store:$},i.a.createElement(H,null)),document.getElementById("root"));var ee=t.default=$}},[[20,1,2]]]);
//# sourceMappingURL=main.a53939db.chunk.js.map